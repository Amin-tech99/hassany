[build]
  builder = "nixpacks"
  buildCommand = "npm install && npm run build"

[deploy]
  startCommand = "npm start"
  healthcheckPath = "/api/health"
  healthcheckTimeout = 300

[nixpacks]
  features = ["nodejs", "ffmpeg"]
  nixPackages = ["ffmpeg"]

[build.env]
  NIXPACKS_FFMPEG_VERSION = "latest"

[[services]]
  internal_port = 3000
  auto_deploy = true

  [services.concurrency]
    hard_limit = 25
    soft_limit = 20

  [[services.ports]]
    handlers = ["http"]
    port = 80
    force_https = true

  [[services.ports]]
    handlers = ["tls", "http"]
    port = 443

  [services.persistence]
    directory = "/data/uploads"
    size = 5